name: Discord Push Notification

on: push

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Gather changed files
        id: changes
        run: |
          echo "::set-output name=list::$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} | paste -sd ", " -)"
      
      - name: Send to Discord
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK }}
          REPO:        ${{ github.repository }}
          BRANCH:      ${{ github.ref_name }}
          MESSAGE:     ${{ github.event.head_commit.message }}
          CHANGES:     ${{ steps.changes.outputs.list }}
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\":\"ðŸ“Œ **${REPO}** @ **${BRANCH}**\nâ€¢ ${MESSAGE}\nâ€¢ Changed: ${CHANGES}\"}" \
               "$WEBHOOK_URL"