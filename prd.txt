# Product Requirements Document (PRD): Video Upload Flow & Channel Selection Overhaul


## 3. Move Upload Authentication to Dashboard

- **Auth**: Use Firebase authentication (see `frontend/firebase/`).
- **UI**: Upload widget and related controls are only visible to authenticated users.
- **Behavior**: If not authenticated, prompt user to sign in before uploading.

---

## 4. Add Channel Selection to Upload Flow

- **Channel Source**: Query Firestore for user’s connected channels (`users/{uid}/channels`).
- **UI Logic**:
    - If user has multiple channels: Present a radio/select list to choose the target channel.
    - If user has only one channel: Auto-select and skip prompt.
- **Upload Payload**: Include the selected `channel_id` in the upload request.
- **UX**: Channel selection is required before upload can proceed.

---

## 5. Backend Endpoint Upgrade

- **API**: Update backend upload endpoint to accept a new `channel_id` field (in multipart/form-data or JSON metadata).
- **Mapping**: Map `channel_id` to the correct GCS prefix (e.g., `daily-raw`, `main-raw`) to maintain compatibility with the existing pipeline.
- **Validation**: Ensure backend rejects uploads without a valid `channel_id`.

---

## 6. Integration Test (Local)

- **Setup**: Run the full stack locally (`docker-compose up`).
- **Test Steps**:
    1. Authenticate as a test user.
    2. Upload a real video via the dashboard.
    3. Select a channel (if more than one).
    4. Confirm the file lands in the correct GCS prefix.
    5. Verify the pipeline triggers and job record is created.
    6. Check that status updates are visible in the dashboard.
- **Acceptance Criteria**: End-to-end flow works for both single-channel and multi-channel users.

---

## 7. Clean-up & Documentation

- **Hero Component**: Remove the “Get Started” link or update it to point to the dashboard.
- **Docs**: Update `ROADMAP.md` and `docs/YOUTUBE_UPLOADER_TESTING.md` to reflect the new flow.
- **Memory Bank**:
    - `activeContext.md`: Document new upload/auth/channel-selection flow.
    - `systemPatterns.md`: Add pattern for channel routing and upload logic.
    - `progress.md`: Track task status and completion.

---

## 8. Open Questions & Revision Points

- Should channel selection be persistent (remember last used) or always prompt?
- How should errors (e.g., no channels connected) be handled in the UI?
- Any additional metadata required for uploads?
- Should the marketing page include a demo or video walkthrough?
- Are there any analytics or tracking requirements for uploads/channel selection?

---

## 9. Sequencing & Dependencies

1. Frontend route and navigation clean-up.
2. Marketing page conversion.
3. Auth migration and UI tweaks.
4. Channel-selection UI and Firestore integration.
5. Backend endpoint update.
6. Local integration test.
7. Documentation and Memory Bank updates.

---

## 10. Success Criteria

- Legacy upload route is fully removed.
- Index route is a public marketing page.
- Authenticated users can upload videos and select channels.
- Uploads are routed to the correct GCS prefix based on channel.
- End-to-end flow is tested and documented.
- All changes are reflected in the Memory Bank and project documentation.
