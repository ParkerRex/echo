Implementing authentication and authorization in your application involves several key aspects. Supabase Auth provides a comprehensive suite of tools and methods to manage user sign-up, sign-in, and access control.

## Core Concepts

Authentication and authorization are fundamental to securing your application[cite: 1986].
* **Authentication** is the process of verifying a user's identity[cite: 1986, 2117, 3368]. This can be achieved through various methods like passwords, magic links, one-time passwords (OTPs), social logins, or single sign-on (SSO)[cite: 1986].
* **Authorization** determines what resources an authenticated user is permitted to access[cite: 1986, 3368]. Supabase Auth integrates with Postgres Row Level Security (RLS) for fine-grained authorization[cite: 1986, 2116].

**JSON Web Tokens (JWTs)** are used by Supabase Auth for authentication[cite: 1986, 2116]. These tokens are sent with every request to Supabase services and are crucial for RLS policies[cite: 2116]. The JWT signing secret is used to sign these tokens; it's vital to keep this secret secure as anyone with access can create arbitrary JWTs[cite: 3369].

---
## User Management

Supabase Auth distinguishes between **permanent users**, who are tied to personally identifiable information (PII) like an email or phone number, and **anonymous users**, who are not tied to any identity and cannot sign back in as the same user if signed out[cite: 2222]. Anonymous sign-ins allow users an authenticated experience without providing PII and can later be converted to permanent users by linking an identity[cite: 1989, 2222].

**User metadata** can be assigned during sign-up and is stored in the `raw_user_meta_data` (updatable by the user) or `raw_app_meta_data` (not updatable by the user) columns in the `auth.users` table[cite: 2123, 2117, 3168].

---
## Authentication Methods

Supabase Auth supports a variety of authentication methods:

### Password-Based Authentication
Users can sign in using a password associated with their email or phone number[cite: 2128].
* **Email and Password**: This is enabled by default. You can configure whether email confirmation is required[cite: 2129]. To sign up, use the appropriate client library method (e.g., `signUp()` in JavaScript)[cite: 2129]. Users can also reset their passwords[cite: 2129].
* **Phone and Password**: Users can use their mobile phone number as an identifier instead of an email[cite: 2130]. It's generally discouraged due to the risk of phone number recycling, unless MFA is implemented[cite: 2130].

### Passwordless Logins
These methods allow users to sign in without a password.
* **Magic Links**: Users click a unique, one-time use link sent to their email to log in[cite: 1995]. The "sign in with OTP" method in client libraries sends a magic link by default[cite: 1995].
* **One-Time Passwords (OTP)**: Users enter a time-sensitive code.
    * **Email OTP**: A six-digit code is sent to the user's email[cite: 1996]. This requires modifying the Magic Link email template to include the `{{ .Token }}` variable[cite: 1996, 1997].
    * **Phone OTP**: A six-digit PIN is sent via SMS, which must be verified within 60 seconds[cite: 2132].

### Social Logins (OAuth)
OAuth allows users to log in using their credentials from other services like Google, Facebook, GitHub, etc.[cite: 2166, 3370]. This can improve user experience and security[cite: 2167]. Supabase supports a suite of social providers, each requiring specific setup[cite: 2167, 2168, 2176, 2178, 2179, 2182, 2183, 2184, 2186, 2192, 2193, 2195, 2196, 2198, 2200, 2201, 2203, 2207]. Provider tokens returned during OAuth can be used to make API calls to the respective provider[cite: 2167].

### Single Sign-On (SSO)
Supabase supports enterprise-level SSO with SAML 2.0 compatible identity providers like Google Workspaces, Okta, and Microsoft Entra ID[cite: 2092, 2221, 3163, 3374]. SAML 2.0 support needs to be enabled and configured for your project[cite: 2093]. User accounts created via SSO are not automatically linked to existing user accounts[cite: 2098].

### Web3 Sign-Ins
Users can authenticate using their Web3 wallet (currently Solana, Ethereum coming soon)[cite: 2088]. This method utilizes the EIP 4361 standard, where users sign a predefined message with their wallet[cite: 2088]. To associate an email or phone number with a Web3 user, use the `updateUser()` or `linkIdentity()` APIs[cite: 2090].

---
## Security Features

### Multi-Factor Authentication (MFA)
MFA adds an extra layer of security by requiring additional verification steps[cite: 2041]. Supabase Auth supports MFA via:
* **App Authenticator (TOTP)**: Users generate a time-based one-time password using an authenticator app (e.g., Google Authenticator, Authy)[cite: 2042, 2066, 3374]. The process involves enrolling a factor, challenging the user, and verifying the code[cite: 2068].
* **Phone Messaging (SMS/WhatsApp)**: A code is sent to the user's phone[cite: 2042, 2054]. This shares configuration with phone OTP login[cite: 2054].
MFA status is encoded in the JWT's `aal` (Authenticator Assurance Level) claim[cite: 2043].

### CAPTCHA Protection
Supabase supports hCaptcha and Cloudflare Turnstile to protect sign-in, sign-up, and password reset forms from bots[cite: 1993, 2082, 2203, 2516, 2659]. This needs to be enabled in the Auth settings and integrated into the frontend[cite: 1994].

### Password Security
Supabase Auth allows fine-grained control over password strength, including minimum length, required character types, and checking against leaked passwords using the HaveIBeenPwned.org API[cite: 2126, 2127]. Passwords are stored hashed using bcrypt with a randomly generated salt[cite: 2127].

### Identity Linking
Supabase Auth can link multiple identities to a single user[cite: 2039].
* **Automatic Linking**: Identities with the same verified email address are automatically linked[cite: 2039]. Unconfirmed identities are removed to prevent pre-account takeover attacks[cite: 2040]. SAML SSO users are not targets for automatic linking[cite: 2040].
* **Manual Linking (Beta)**: Allows users to link identities manually. This requires enabling manual linking in project settings[cite: 1990, 2040].

---
## Client-Side Implementation

### Supabase Client SDKs
Supabase provides client SDKs (JavaScript, Flutter, Swift, Python, C#, Kotlin) that handle HTTP calls, token persistence, and integration with other Supabase products[cite: 1988, 2233]. You initialize the client with your project URL and anon key[cite: 2285, 2686, 2791, 2800, 2805, 2807, 2814, 2816].

### Auth UI Components
Pre-built UI components are available for popular frameworks:
* **React Auth UI**: A React component for user authentication that supports custom themes and styles[cite: 2005]. It can be configured with social providers and various appearance options[cite: 2006, 2007, 2008, 2009, 2010, 2011, 2012].
* **Flutter Auth UI**: A Flutter package with pre-built, unstyled widgets for email, magic link, social, and phone authentication[cite: 2013, 2014, 2015].

### Server-Side Rendering (SSR)
For SSR frameworks like Next.js, SvelteKit, and Remix, Supabase Auth needs to store user sessions in cookies instead of local storage[cite: 2005, 2144]. The `@supabase/ssr` package simplifies this setup[cite: 2144, 2149, 2659, 2809]. The PKCE flow should be used for SSR instead of the implicit flow[cite: 2145, 2149, 2163].

### Deep Linking
Many auth methods (email confirmations, magic links, OAuth) involve redirecting the user back to your app[cite: 2124]. Deep linking ensures users are redirected to a specific page within your mobile or web app[cite: 2001, 2124, 2134, 2143, 2683, 2690]. You'll need to configure redirect URLs in your Supabase project and handle them in your app[cite: 2134].

---
## Advanced Customization

### Email Templates
Supabase allows customization of email templates for actions like confirming sign-up, inviting users, sending magic links, changing email addresses, and resetting passwords[cite: 1998, 2081, 2143, 2507, 2516, 2557, 2810, 2877]. Templates can use variables like `{{ .ConfirmationURL }}`, `{{ .Token }}`, and `{{ .SiteURL }}`[cite: 1999, 2000, 2001, 2557]. Go Templates enable conditional rendering in emails[cite: 2004].

### Auth Hooks
Hooks allow you to alter the default Supabase Auth flow at specific points to add custom behavior[cite: 2016].
* **Custom Access Token Hook**: Modify JWT claims before a token is issued[cite: 2022, 2394, 2395]. This is useful for implementing Role-Based Access Control (RBAC)[cite: 2394].
* **Send SMS/Email Hooks**: Customize message content or use custom providers[cite: 2018, 2034, 2038, 2575].
* **MFA/Password Verification Attempt Hooks**: Add additional security checks to MFA and password logins[cite: 2017, 2018, 2026, 2031]. (Available on Teams and Enterprise plans) [cite: 2017, 2018]
Hooks can be SQL functions or HTTP endpoints[cite: 2018].

### Third-Party Auth Providers
Supabase supports using external auth providers like Clerk, Firebase Auth, Auth0, and AWS Cognito[cite: 2209, 2210, 2211, 2214, 2220]. Your Supabase project can be configured to trust JWTs issued by these providers[cite: 2221]. This typically involves adding the provider in your Supabase settings and ensuring the JWTs contain necessary claims like `role: 'authenticated'`[cite: 2208, 2210, 2212, 2215, 2218].

---
## Architectural Overview

Supabase Auth consists of four main layers:
1.  **Client Layer**: Your application code (frontend, backend, or native) that interacts with Auth functions[cite: 1987, 1988].
2.  **Kong API Gateway**: Shared among all Supabase products[cite: 1987].
3.  **Auth Service (GoTrue)**: An API server that validates/issues JWTs and communicates with external providers[cite: 1987, 1988, 2563, 3397].
4.  **Postgres Database**: Stores user data and Auth information in the `auth` schema[cite: 1987, 1989]. This schema is not directly exposed via the auto-generated API for security reasons[cite: 1989].