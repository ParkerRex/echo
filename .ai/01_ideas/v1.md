# YouTube Content Automation Platform - PRD v2

## Product Vision
Build a content creator's command center that eliminates friction between idea and upload, while providing intelligence on competition, sponsorships, and revenue optimization.

## Core User Journey
```
Discover â†’ Ideate â†’ Outline â†’ Record â†’ Package â†’ Schedule â†’ Publish â†’ Monetize â†’ Analyze
```

## Technical Architecture (Inspired by Midday)

### Stack Overview
```
Browser â†’ tRPC â†’ Hono API â†’ Postgres (Supabase)
                     â†“
               Engine Worker â†’ YouTube API, Stripe, AI Services
```

### Layers
| Layer         | What lives here                    | Key tech                                |
| ------------- | ---------------------------------- | --------------------------------------- |
| UI            | Next.js + React Query + tRPC hooks | typed queries, cache                    |
| Core API      | Hono (`apps/api`)                  | auth, business rules, DB routing        |
| Database      | Supabase Postgres                  | RLS, JWT, vector embeddings             |
| Engine Worker | Cloudflare Worker (`apps/engine`)  | YouTube scraping, AI calls, Stripe sync |
| iOS App       | Swift + tRPC client (later)        | quick capture, on-the-go management     |

## Feature Roadmap (Updated)

### ðŸš€ Phase 1: Core Pipeline + Intelligence (Weeks 1-4)

#### 1.1 Quick Capture System
**Technical Tasks:**
- [ ] Build idea input with cmd+enter submit
- [ ] Add paste detection (idea vs transcript classifier)
- [ ] Create Chrome extension for YouTube competitor tracking
- [ ] Add voice-to-text idea capture via Whisper
- [ ] Build keyboard shortcuts for all actions

#### 1.2 AI Content Generation
**Technical Tasks:**
- [ ] Implement Claude API integration with retry logic
- [ ] Create prompt templates for different video types
- [ ] Build title scoring based on competitor performance
- [ ] Add "regenerate with tweaks" functionality
- [ ] Implement prompt versioning system

#### 1.3 Competitor Intelligence Dashboard
**User Stories:**
- As a creator, I want to track competitors' best performing videos
- As a creator, I want to see what's working in my niche

**Technical Tasks:**
- [ ] Build YouTube API scraper for channel monitoring
- [ ] Create keyword-based video discovery
- [ ] Implement performance tracking (views, engagement rate)
- [ ] Add video transcript extraction for topic analysis
- [ ] Build "gap finder" - topics competitors missed
- [ ] Create weekly competitor report emails

### ðŸ“Š Phase 2: Monetization & Sponsorships (Weeks 5-7)

#### 2.1 Sponsor Discovery Engine
**User Stories:**
- As a creator, I want to find brands advertising in my niche
- As a creator, I want to track sponsor relationships

**Technical Tasks:**
- [ ] Build transcript analyzer for sponsor mentions
- [ ] Create sponsor database with contact enrichment
- [ ] Implement sponsor frequency tracking across channels
- [ ] Add CRM features for sponsor outreach
- [ ] Build email templates for sponsor pitches
- [ ] Create sponsor performance tracking (CPM, conversion)

#### 2.2 Revenue Scorecard
**User Stories:**
- As a creator, I want to see all revenue streams in one place
- As a creator, I want to project future earnings

**Technical Tasks:**
- [ ] Integrate Stripe API for payment tracking
- [ ] Connect YouTube Analytics for AdSense data
- [ ] Build revenue forecasting based on view trends
- [ ] Create expense tracking for ROI calculation
- [ ] Add goal setting with progress tracking
- [ ] Implement tax estimation features

### ðŸ” Phase 3: Content Discovery & Trends (Weeks 8-10)

#### 3.1 Multi-Source Idea Discovery
**User Stories:**
- As a creator, I want to see trending topics from multiple sources
- As a creator, I want AI to suggest video ideas based on trends

**Technical Tasks:**
- [ ] Build RSS feed aggregator for blogs
- [ ] Integrate X (Twitter) API for trending topics
- [ ] Add YouTube trending API integration
- [ ] Create podcast transcript analyzer
- [ ] Build AI idea generator based on trends
- [ ] Implement "virality score" predictor

#### 3.2 Content Calendar Intelligence
**User Stories:**
- As a creator, I want to plan content around trending events
- As a creator, I want to maintain topical diversity

**Technical Tasks:**
- [ ] Build event detection system (holidays, launches, etc)
- [ ] Create content mix analyzer
- [ ] Add series planning features
- [ ] Implement burnout prevention (pacing recommendations)
- [ ] Build collaboration features for teams

## Updated Database Schema

```sql
-- Competitor tracking
competitors (
  id uuid PRIMARY KEY,
  channel_name text,
  youtube_channel_id text,
  tracking_keywords text[],
  is_manual boolean,
  last_scraped_at timestamp
)

competitor_videos (
  id uuid PRIMARY KEY,
  competitor_id uuid REFERENCES competitors(id),
  youtube_video_id text,
  title text,
  views int,
  likes int,
  comments int,
  published_at timestamp,
  transcript text,
  detected_sponsors text[],
  performance_score float
)

-- Sponsor management
sponsors (
  id uuid PRIMARY KEY,
  company_name text,
  contact_email text,
  contact_person text,
  industry text,
  avg_sponsorship_value decimal,
  last_contact_date timestamp,
  relationship_status enum('cold', 'contacted', 'negotiating', 'active', 'past')
)

sponsor_mentions (
  id uuid PRIMARY KEY,
  sponsor_id uuid REFERENCES sponsors(id),
  video_id text,
  channel_name text,
  mention_type enum('description', 'transcript', 'pinned_comment'),
  detected_at timestamp
)

-- Revenue tracking
revenue_streams (
  id uuid PRIMARY KEY,
  source enum('youtube_ads', 'sponsorship', 'affiliate', 'course', 'other'),
  amount decimal,
  currency text,
  period_start date,
  period_end date,
  stripe_payment_id text,
  notes text
)

-- Content discovery
content_sources (
  id uuid PRIMARY KEY,
  type enum('youtube_channel', 'blog', 'podcast', 'twitter_user'),
  name text,
  url text,
  rss_feed text,
  check_frequency enum('hourly', 'daily', 'weekly'),
  last_checked_at timestamp
)

trending_topics (
  id uuid PRIMARY KEY,
  topic text,
  source_id uuid REFERENCES content_sources(id),
  trend_score float,
  mentioned_count int,
  first_seen_at timestamp,
  peak_at timestamp,
  suggested_angles text[]
)

-- Add vector embeddings for semantic search
video_embeddings (
  id uuid PRIMARY KEY,
  video_id uuid REFERENCES videos(id),
  embedding vector(1536),
  model_version text
)
```

## Updated API Structure

```typescript
export const appRouter = router({
  // Existing routers...
  
  // Competitor intelligence
  competitors: router({
    track: publicProcedure
      .input(z.object({
        channelUrl: z.string().optional(),
        keywords: z.array(z.string()).optional()
      }))
      .mutation(async ({ input, ctx }) => {
        // Add to tracking queue
      }),
    
    getInsights: publicProcedure
      .input(z.object({
        timeframe: z.enum(['week', 'month', 'quarter'])
      }))
      .query(async ({ input, ctx }) => {
        // Return competitor performance data
      }),
    
    findGaps: publicProcedure
      .query(async ({ ctx }) => {
        // Analyze topics you haven't covered
      })
  }),
  
  // Sponsor discovery
  sponsors: router({
    discover: publicProcedure
      .input(z.object({
        niche: z.string(),
        minVideos: z.number().default(3)
      }))
      .query(async ({ input, ctx }) => {
        // Find sponsors in your niche
      }),
    
    trackMention: publicProcedure
      .input(z.object({
        videoUrl: z.string(),
        sponsorName: z.string()
      }))
      .mutation(async ({ input, ctx }) => {
        // Add sponsor mention
      })
  }),
  
  // Revenue tracking
  revenue: router({
    connectStripe: publicProcedure
      .mutation(async ({ ctx }) => {
        // OAuth flow for Stripe
      }),
    
    getScorecard: publicProcedure
      .input(z.object({
        period: z.enum(['month', 'quarter', 'year'])
      }))
      .query(async ({ input, ctx }) => {
        // Aggregate all revenue sources
      }),
    
    forecast: publicProcedure
      .query(async ({ ctx }) => {
        // ML-based revenue prediction
      })
  }),
  
  // Content discovery
  discovery: router({
    addSource: publicProcedure
      .input(z.object({
        type: z.enum(['youtube_channel', 'blog', 'podcast', 'twitter_user']),
        identifier: z.string()
      }))
      .mutation(async ({ input, ctx }) => {
        // Add to monitoring
      }),
    
    getTrending: publicProcedure
      .query(async ({ ctx }) => {
        // Return trending topics with AI suggestions
      }),
    
    generateIdeas: publicProcedure
      .input(z.object({
        basedOn: z.enum(['trends', 'competitors', 'gaps'])
      }))
      .mutation(async ({ input, ctx }) => {
        // AI generates video ideas
      })
  })
});
```

## Engine Worker Responsibilities

```typescript
// apps/engine/src/index.ts
export default {
  async fetch(request: Request): Promise<Response> {
    const { pathname } = new URL(request.url);
    
    switch (pathname) {
      case '/youtube/scrape':
        return handleYouTubeScrape(request);
      
      case '/youtube/transcript':
        return handleTranscriptExtraction(request);
        
      case '/ai/embeddings':
        return handleEmbeddingGeneration(request);
        
      case '/stripe/sync':
        return handleStripeWebhook(request);
        
      case '/content/analyze':
        return handleContentAnalysis(request);
    }
  }
};
```

## Background Jobs (Trigger.dev)

```typescript
// packages/jobs/src/tasks/competitor-analysis.ts
export const analyzeCompetitors = task({
  id: "analyze-competitors",
  schedule: "0 */6 * * *", // Every 6 hours
  run: async () => {
    // 1. Fetch new videos from tracked channels
    // 2. Extract transcripts
    // 3. Detect sponsors
    // 4. Calculate performance metrics
    // 5. Generate embeddings for similarity search
  }
});

// packages/jobs/src/tasks/trend-detection.ts
export const detectTrends = task({
  id: "detect-trends",
  schedule: "0 * * * *", // Hourly
  run: async () => {
    // 1. Check all content sources
    // 2. Extract topics using NLP
    // 3. Calculate trend velocity
    // 4. Generate video ideas
    // 5. Send notifications for hot trends
  }
});
```

## Shared Packages

```typescript
// packages/youtube-sdk/
export * from './scraper';
export * from './transcript';
export * from './analytics';

// packages/ai-tools/
export * from './embeddings';
export * from './idea-generator';
export * from './sponsor-detector';

// packages/revenue/
export * from './stripe-client';
export * from './forecasting';
export * from './tax-calculator';
```

## iOS App Architecture (Future)

```swift
// Quick capture focused
- Idea capture with voice
- Competitor video bookmarking  
- Revenue dashboard widget
- Push notifications for trends

// Sync via tRPC
- Type-safe API client
- Offline-first with sync
- Background trend monitoring
```

## Key Technical Decisions

### 1. Vector Search for Content
- Use Supabase pgvector for semantic similarity
- Find videos similar to your best performers
- Discover content gaps in your niche

### 2. Competitor Tracking Strategy
- YouTube API for public data
- Cloudflare Worker for transcript extraction
- Respect rate limits with queue system

### 3. Multi-tenant Architecture
- Row Level Security for all user data
- Shared competitor/sponsor data with attribution
- Cached public data for efficiency

This architecture gives you:
- **Intelligence layer** for competitive advantage
- **Monetization tracking** for business insights  
- **Discovery engine** for never running out of ideas
- **Type safety** across web and future iOS app
- **Scalable workers** for heavy processing

Want me to detail any specific component or create implementation examples for the new features?